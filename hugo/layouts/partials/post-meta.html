{{/* 1. Adding lastmod and date variables and markup to show a last-edited date.

  2. Wrapping date in permalink, microformat class, and time element (for indieweb).

  3. Inserting CATEGORIES section and separating out TAGS section.

  4. Removing 'writeSeparator' = true
*/}}
{{ $lastmod := .Lastmod.Format "2006-01-02" }}
{{ $date := .Date.Format "2006-01-02" }}
{{- $showShare := ne (.Param "showshare") false }}
{{- $showDate := ne (.Param "showdate") false }}
{{- $showReadTime := ne (.Param "showreadtime") false }}
{{- $showPostMeta := or ($showShare) ($showDate) ($showReadTime) (isset .Params "tags") }}
{{- $scratch := newScratch }}
{{- $scratch.Set "writeSeparator" false }}
{{- if $showPostMeta }}
  <div class="post_meta">
    <span class="post_byline"
      >By
      <span class="p-author"
        >{{ .Params.author | default .Site.Author.name }}</span
      ></span
    >
    {{- if $showDate }}
      <span class="post_date_icon"
        >{{ partial "sprite" (dict "icon" "calendar") }}</span
      >
      <a class="post_date u-url" href="{{ .Permalink }}" title="Permalink">
        <time class="dt-published">
          {{ .Date.Format (default "Jan 2, 2006" $.Site.Params.dateFormat) -}}
        </time>
      </a>
      {{ if ne $lastmod $date }}
        <span class="post_date__edit"
          >&nbsp;Edited on
          {{ .Lastmod.Format (default "Jan 2, 2006" $.Site.Params.dateFormat) }}&nbsp;</span
        >
      {{ else }}
        {{/* No edits present. */}}
      {{ end }}
    {{- end }}
    {{- if $showReadTime }}
      <span class="post_time"
        >{{ if ($scratch.Get "writeSeparator") }}
          路
        {{ end }}{{ T "reading_time" . }}</span
      >
    {{- end }}

    {{/* CATEGORIES */}}
    {{- with .Params.categories -}}
      <span class="post_categories">
        {{- if ($scratch.Get "writeSeparator") }}&nbsp;路{{ end }}
        {{- range . }}
          {{- $tag := urlize . -}}
          <a
            href="{{ absLangURL (printf "categories/%s/" $tag) }}"
            title="View all content categorized as '{{ humanize . }}'"
            class="post_tag--cat post_tag button button_translucent"
          >
            {{- . }}
          </a>
        {{- end }}
      </span>
    {{- end }}

    {{/* TAGS */}}
    {{- with .Params.tags -}}
      <span class="post_tags">
        {{- if ($scratch.Get "writeSeparator") }}&nbsp;路{{ end }}
        {{- range . }}
          {{- $tag := urlize . -}}
          <a
            href="{{ absLangURL (printf "tags/%s/" $tag) }}"
            title="View all content tagged with '{{ humanize . }}'"
            class="post_tag button button_translucent"
          >
            {{- . }}
          </a>
        {{- end }}
      </span>
    {{- end }}

    {{- if $showShare }}
      <span class="page_only"
        >{{ if ($scratch.Get "writeSeparator") }}
          &nbsp;路
        {{ end }}{{ partial "share" . }}</span
      >
    {{- end }}

  </div>
{{- end }}
