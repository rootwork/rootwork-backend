{{/* getDate:

  Retrieve published date and, if modified, updated date.
*/}}

{{/* Adding a random number of seconds+millisecs to ensure no two dates are exactly the same, required for feed validation. */}}
{{- $title := partial "function/vars/getTitle" . -}}
{{- $seed := int ( printf "0x%.8s" (md5 ($title.linked))) -}}
{{- $rnd := mod (add (mul 13 $seed) 97) 400 -}}

{{- $published := .Date -}}
{{- $publishedExact := $published.Unix -}}
{{- $publishedExact = add $publishedExact $rnd -}}

{{- $updated := .Lastmod -}}
{{- $updatedExact := $updated -}}

{{- if eq .Date .Lastmod -}}
  {{- $updated = "" -}}
  {{- $updatedExact = "" -}}
{{- else -}}
  {{- $updatedExact = .Lastmod.Unix -}}
  {{- $updatedExact = add $updatedExact $rnd -}}
{{- end -}}

{{- $date := dict
  "published"      $published
  "updated"        $updated
  "publishedExact" $publishedExact
  "updatedExact"   $updatedExact
-}}

{{- return $date -}}
